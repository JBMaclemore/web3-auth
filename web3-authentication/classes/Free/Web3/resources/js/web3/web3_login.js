let userLoginData={state:"loggedOut",ethAddress:"",publicName:"",config:{headers:{"Content-Type":"application/x-www-form-urlencoded"}}};var isTesting,shortcode,publicAddress,modal,_event,is_testing_wallet_address=!1,ajaxurl=mo_web3_utility_object.ajax_url,wp_nonce=mo_web3_utility_object.wp_nonce;async function connectToMyAlgo(e=0,t=!1,n=null){let a=new MyAlgoConnect({disableLedgerNano:!1}),l;try{let i=await a.connect({shouldSelectOneAccount:!1,openManager:!1}),o=i.map(e=>e.address);l=o[0]}catch(s){console.error(s);return}let r={blockchain:"algorand",address:l,walletType:"NotASignedAuth"};(t&&(r.redirectionUrl=n),e)?openModal(l):handleAfterAuthenticationFlow(l,r)}async function getAccount(e=0,t=!1,n=null){let a=window.solana&&window.solana.isPhantom,l;if(!0==a){await window.solana.connect(),await window.solana.request({method:"connect"}),await window.solana.isConnected,await window.solana.autoApproved;let i={blockchain:"solana",address:l=window.solana.publicKey,walletType:"NotASignedAuth"};(t&&(i.redirectionUrl=n),e)?openModal(l):handleAfterAuthenticationFlow(l.toString(),i)}else window.alert("Solana object not found! Get a Phantom wallet!!"),window.location="https://www.phantom.app/"}function disconnectAccount(){window.solana.disconnect(),window.solana.on("disconnect",()=>console.log("disconnected!"))}async function userLoginOut(e=0,t=null,n=!1,a=null){"metamask"==t?await connectWithMetaMask():"walletConnect"==t?await connectWithWalletConnect():"coinbase"==t&&await connectWithCoinBase();let l="";if(isTesting=e,(l=await onConnectLoadWeb3Modal()).err){showMessage(l.err);return}if(web3ModalProv){window.web3=web3ModalProv;try{userLogin(a)}catch(i){return}}}async function userLogin(e){let t;try{t=await web3.eth.getAccounts()}catch(n){console.error("error ",n.message)}let a=t[0];if(null==(a=a.toLowerCase())){showMessage("<strong>Error:</strong> No wallet address found");return}var l={action:"type_of_request",request:"login",address:a,mo_web3_verify_nonce:wp_nonce};jQuery.post(ajaxurl,l,function(t){var n,l;"Error"!=t.substring(0,5)?(n=t,l=publicAddress=a,new Promise((e,t)=>{showMessage("Waiting for your signature","msg"),web3.eth.personal.sign(web3.utils.utf8ToHex(n),l,(n,a)=>n?(console.log("",n),t({msg:n.message})):e({publicAddress:l,signature:a}))})).then(function t({publicAddress:n,signature:a}){jQuery.post(ajaxurl,{action:"type_of_request",address:n,request:"auth",signature:a,mo_web3_verify_nonce:wp_nonce},async function(t){if("Only metamask wallet allowed"===t.error)alert("Please Login with MetaMask Wallet");else if(t.isSignatureVerified){if(isTesting)openModal(n);else{let a={address:n,nonce:t.nonce,walletType:"SignedAuth"};e&&(a.redirectionUrl=e),handleAfterAuthenticationFlow(n,a)}}})}).catch(e=>{console.log("error",e),showMessage("<strong>Error:</strong> "+e.msg)}):console.log("Error: "+t)})}function handleAfterAuthenticationFlow(e,t){is_testing_wallet_address&&(e=is_testing_wallet_address);var n={action:"type_of_request",request:"get_configuration",address:e,mo_web3_verify_nonce:wp_nonce};jQuery.post(ajaxurl,n,async function(n){let a=n.error?n.error:null;if(a){console.log(a);return}let l=n.newUserRegisteration?n.newUserRegisteration:null;n.adminNftSetting&&n.adminNftSetting;let i=n.tokenConfigDetails?n.tokenConfigDetails:null,o=n.roleMappingSetting?n.roleMappingSetting:null,s=n.inlineFormSetting?n.inlineFormSetting:null,r=n.custom_profile_completion_redirect_url?n.custom_profile_completion_redirect_url:null,d=n.inline_form_toggle?n.inline_form_toggle:null;if(i){let c=await checkAllTokensConfigs(e,i);if(t.tokenConfigResults=JSON.stringify(c),o){let m=await checkRoleMapping(e,o,i,c);t.contracts=JSON.stringify(m)}}l&&"checked"==d?(null!==r?post_to_url("",t,"post"):await getUserDetails(s),document.getElementById("userDetailSubmit").addEventListener("click",function(){for(var e in submittedAllRequired=!0,s){if(meta_value=document.getElementsByName(s[e].meta_key)[0].value,s[e].required&&""==meta_value){submittedAllRequired=!1;break}t[s[e].meta_key]=document.getElementsByName(s[e].meta_key)[0].value}if(submittedAllRequired){if(document.getElementById("requiredError").style.display="none",void 0!=t.user_email||void 0!=t.nickname){let n={action:"type_of_request",request:"checkInputFields",email:t.user_email,display_name:t.nickname,mo_web3_verify_nonce:wp_nonce};jQuery.post(ajaxurl,n,function(e){document.getElementById("emailError").style.display="none";var n=document.getElementById("duplicateDisplayName"),a=document.getElementById("invalidDisplayName");null!=n&&(document.getElementById("duplicateDisplayName").style.display="none"),null!=a&&(document.getElementById("invalidDisplayName").style.display="none"),"success"==e?post_to_url("",t,"post"):"duplicate email"==e?document.getElementById("emailError").style.display="block":"duplicate display name"==e&&null!=document.getElementById("duplicateDisplayName")?document.getElementById("duplicateDisplayName").style.display="block":"invalid display name"==e&&null!=document.getElementById("invalidDisplayName")&&(document.getElementById("invalidDisplayName").style.display="block")})}else post_to_url("",t,"post")}else document.getElementById("requiredError").style.display="block"})):post_to_url("",t,"post")})}function openModal(e){document.getElementById("wallet_address").innerText=e,document.getElementById("moweb3_test_modal").style.display="block",jQuery("body").append(jQuery("#moweb3_test_modal")),document.getElementById("moweb3_display_modal").click()}function post_to_url(e,t,n,a="mo_web3_hiddenform_nonce"){n=n||"post",e=ajaxurl;var l=document.createElement("form");for(var i in l.setAttribute("method",n),l.setAttribute("action",e),t)if(t.hasOwnProperty(i)){var o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name",i),o.setAttribute("value",t[i]),l.appendChild(o)}var o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name",a),o.setAttribute("value",wp_nonce),l.appendChild(o),document.body.appendChild(l),l.submit()}function showMessage(e,t="error"){let n;(n=document.getElementById("moweb3CustomErrorMessage")).innerHTML=e}function elementExist(e="customErrorMsg"){return null==document.getElementById(e)}async function getUserDetails(e){let t="";for(var n in t+='<div style="max-width:100%;color:black;padding-top:3%" class="moweb3-modal" id="moweb3-modal-profile-completion"  aria-labelledby="exampleModalLabel" aria-hidden="true">',t+='<div class="moweb3-modal-dialog">',t+='<div class="moweb3-modal-content">',t+='<div class="moweb3-modal-header">',t+='<h3 class="moweb3-remove-margin moweb3-h3" >Please Enter Your Details to Update Your Profile</h3>',t+="</div>",t+='<hr class="moweb3-hr" style="margin-bottom:3%">',t+='<div class="moweb3-modal-body">',t+='<div id="requiredError" style="color:red;display:none;margin-left:5%">Enter all required fields</div>',e)required="",e[n].required&&(required="*"),t+='<div style="margin:auto 5%">',t+='<label for="'+e[n].meta_key+'" >'+e[n].label+required+"</label>","user_email"==e[n].meta_key?(t+='<input class="moweb3-inline-form-input" style="width:100%;" type="'+e[n].type+'"  name="'+e[n].meta_key+'">',t+='<div id="emailError" style="color:red;display:none">This email is already associated with an account</div>'):t+='<input class="moweb3-inline-form-input" type="'+e[n].type+'" name="'+e[n].meta_key+'">',"nickname"==e[n].meta_key&&(t+='<div id="duplicateDisplayName" style="color:red;display:none">This display name is already associated with an account</div>',t+='<div id="invalidDisplayName" style="color:red;display:none">This display name is invalid </div>'),t+="</div>";t+='<input id="userDetailSubmit" class="moweb3-btn moweb3-btn-primary" style="margin: auto 5% 5% 5%!important" type="submit" value="Submit"   />',t+="</div>",t+="</div>",t+="</div>",t+="</div>",jQuery(document.body).append(t),document.getElementById("moweb3-modal-profile-completion").style.display="block"}function clearMessage(){let e;(e=document.getElementById("moweb3CustomErrorMessage")).innerHTML="",jQuery("body").append(jQuery("#multipleCryptowalletModal"))}function customWalletLoginModal(){var e;modal=document.getElementById("moweb3-modal-id"),jQuery("body").append(modal),e=document.getElementById("moweb3Btn"),modal.style.display="block"}function closeWeb3Modal(){modal.style.display="none"}window.onclick=function(e){_event=e;let t=document.getElementsByClassName("moweb3-modal-dialog")[0];e.target==t&&(modal.style.display="none")};